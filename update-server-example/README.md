# Auto-Update Server Setup Guide

This folder contains example files and setup instructions for hosting your app's auto-updates.

## Server Structure

Your update server should host these files:

```
/updates/
├── latest.yml              # Update metadata (generated by electron-builder)
├── E-commerce-SAAS-Manager-Setup-1.0.0.exe    # Windows installer
├── E-commerce-SAAS-Manager-1.0.0.nupkg        # Windows delta update package
└── win/
    └── E-commerce-SAAS-Manager-Setup-1.0.0.exe
```

## Deployment Steps

### 1. Build Your App for Distribution

```bash
# Build React app and create Electron distributables
npm run dist

# This creates files in /dist/:
# - win-unpacked/           # Unpacked Windows app
# - E-commerce-SAAS-Manager Setup 1.0.0.exe  # Windows installer
# - latest.yml              # Update metadata
# - *.nupkg                 # Delta update packages
```

### 2. Set Up Your Update Server

#### Option A: Simple File Server (Node.js/Express)

```javascript
const express = require('express');
const path = require('path');
const app = express();

// Enable CORS for electron-updater
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Headers', 'Content-Type');
  next();
});

// Serve update files
app.use('/updates', express.static(path.join(__dirname, 'updates')));

app.listen(3001, () => {
  console.log('Update server running on http://localhost:3001');
});
```

#### Option B: Static File Hosting

Upload to any static file host:
- **AWS S3** + CloudFront
- **Netlify** (static files)
- **Vercel** (static files)
- **GitHub Pages** (public repos)
- **Your own web server**

### 3. Update package.json

Update the publish URL in your package.json:

```json
{
  "build": {
    "publish": {
      "provider": "generic",
      "url": "https://your-domain.com/updates/"
    }
  }
}
```

### 4. Release Process

When you want to release an update:

1. **Update version** in package.json:
   ```json
   {
     "version": "1.0.1"
   }
   ```

2. **Build and distribute**:
   ```bash
   npm run dist
   ```

3. **Upload files** to your server:
   - `latest.yml` (contains version info)
   - `*.exe` (full installer)
   - `*.nupkg` (delta update)

4. **Users get notified** automatically when they open the app!

## Security Considerations

### Code Signing (Recommended)

For production apps, sign your executables to avoid Windows security warnings:

1. **Get a code signing certificate** from a trusted CA
2. **Configure electron-builder** in package.json:

```json
{
  "build": {
    "win": {
      "certificateFile": "path/to/certificate.p12",
      "certificatePassword": "your-password",
      "signingHashAlgorithms": ["sha256"],
      "timestampServer": "http://timestamp.digicert.com"
    }
  }
}
```

### HTTPS

Always serve updates over HTTPS to prevent man-in-the-middle attacks.

## Testing Auto-Updates

### Local Testing

1. **Set up a local server**:
   ```bash
   cd update-server-example
   npm install express
   node simple-server.js
   ```

2. **Update your package.json** to point to localhost:
   ```json
   {
     "build": {
       "publish": {
         "provider": "generic",
         "url": "http://localhost:3001/updates/"
       }
     }
   }
   ```

3. **Build and test**:
   ```bash
   npm run dist
   # Copy files to update-server-example/updates/
   # Install the app from dist/
   # Change version in package.json
   # Build again and copy new files
   # Run the installed app to test updates
   ```

## Troubleshooting

### Common Issues

1. **CORS errors**: Ensure your server sends proper CORS headers
2. **File not found**: Check that latest.yml is accessible at the publish URL
3. **Signature verification failed**: Use code signing or disable verification for testing
4. **Updates not detected**: Check the version format in package.json (semantic versioning)

### Debug Logs

Auto-updater logs are written to `electron-main.log`. Check this file for detailed error messages.

## Advanced Features

### Staged Rollouts

You can implement staged rollouts by modifying latest.yml:

```yaml
version: 1.0.1
files:
  - url: E-commerce-SAAS-Manager-Setup-1.0.1.exe
    sha512: [hash]
    size: [bytes]
path: E-commerce-SAAS-Manager-Setup-1.0.1.exe
sha512: [hash]
releaseDate: '2025-09-17T10:00:00.000Z'
stagingPercentage: 50  # Only 50% of users get this update initially
```

### Custom Update UI

Replace the default dialogs with custom React components by sending messages between main and renderer processes.
